{
    "services": {
        "immutant": {
            "discovery": {
                "method": "docker",
                "servers": [{
                    "name": "docker1",
                    "host": "docker1-int.turbovote.org"
                }, {
                    "name": "docker2",
                    "host": "docker2-int.turbovote.org"
                }],
                "image_name": "quay.io/democracyworks/immutant",
                "container_port": 8080,
                "check_interval": 5
            },
            "haproxy": {
                "port": 8081,
                "server_options": "check inter 2s rise 3 fall 2",
                "listen": [
                    "mode http"
                ]
            }

        }
    },
    "haproxy": {
        "reload_command": "service haproxy reload",
        "config_file_path": "/etc/haproxy/haproxy.cfg",
        "socket_file_path": "/var/haproxy/stats.sock",
        "do_writes": true,
        "do_reloads": true,
        "do_socket": false,
        "global": [
            "daemon",
            "user haproxy",
            "group haproxy",
            "maxconn 4096",
            "ulimit-n 8207",
            "log     127.0.0.1 local0",
            "log     127.0.0.1 local1 notice",
            "stats   socket /var/haproxy/stats.sock mode 666 level admin"
        ],
        "defaults": [
            "log      global",
            "option   dontlognull",
            "maxconn  2000",
            "retries  3",
            "timeout  connect 5s",
            "timeout  client  1m",
            "timeout  server  1m",
            "option   redispatch",
            "balance  roundrobin"
        ],
        "extra_sections": {
            "frontend http-in": [
                "mode http",
                "bind *:80",
                "capture request header Host len 64",
                "acl is_ballot_scout hdr_end(host) -i ballotscout.org",
                "use_backend ballot_scout if is_ballot_scout",
                "acl is_address hdr_end(host) -i api-int.turbovote.org",
                "use_backend address if is_address",
                "acl is_sendgrid_monitor hdr_end(host) -i sendgrid-monitor.democracy.works",
                "use_backend sendgrid_monitor if is_sendgrid_monitor"
            ],
            "backend ballot_scout": [
                "mode http",
                "reqrep ^([^\\ ]*)\\ (.+)    \\1\\ /ballot-scout\\2",
                "balance roundrobin",
                "option httpclose",
                "option forwardfor",
                "server local localhost:8081 maxconn 32"
            ],
            "backend address": [
                "mode http",
                "reqrep ^([^\\ ]*)\\ (.+)    \\1\\ /nixon\\2",
                "balance roundrobin",
                "option httpclose",
                "option forwardfor",
                "server local localhost:8081 maxconn 32"
            ],
            "backend sendgrid_monitor": [
                "mode http",
                "reqrep ^([^\\ ]*)\\ (.+)    \\1\\ /sendgrid-monitor\\2",
                "balance roundrobin",
                "option httpclose",
                "option forwardfor",
                "server local localhost:8081 maxconn 32"
            ]
        }
    }
}
